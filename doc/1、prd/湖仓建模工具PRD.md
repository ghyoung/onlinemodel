# 湖仓建模工具产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品背景
随着企业数据规模增长，传统的数据建模方式已无法满足快速迭代和协作需求。需要一个现代化的湖仓建模工具，提供可视化的建模体验、自动化的元数据管理、以及智能化的数据治理能力。

### 1.2 产品定位
面向数据工程师、数据架构师、业务分析师的一站式湖仓建模平台，提供从设计到开发、从文档到代码的全流程支持。

### 1.3 目标用户
- **主要用户**：数据工程师、数据架构师
- **次要用户**：业务分析师、产品经理
- **管理员**：数据治理专员、系统管理员

## 2. 功能需求

### 2.1 核心功能模块

#### 2.1.1 DDL快速导入模块 (P0)
**功能描述**：支持快速导入现有数仓的DDL语句，实现逆向建模

**详细需求**：

**数据库连接管理**：
- 支持MySQL、PostgreSQL、Hive、ClickHouse等主流数据库连接配置
- 支持连接参数配置：主机、端口、数据库名、用户名、密码、连接池配置
- 提供连接测试功能，实时验证连接有效性
- 支持连接信息加密存储和连接历史管理

**表列表管理**：
- 支持数据库表列表展示，包含表名、表类型、记录数、大小等基础信息
- 支持表列表分页加载和虚拟滚动，提升大规模表库性能
- 支持表搜索和筛选：按表名、表类型、创建时间等条件筛选
- 支持表勾选功能：单选、多选、全选、反选等操作

**导入功能**：
- 支持批量导入和单表导入两种模式
- 支持导入预览：显示解析后的表结构、字段信息、约束关系
- 支持冲突检测：自动识别已存在的表和字段，提供覆盖、跳过、重命名等选项
- 支持增量同步：只导入新增或变更的表结构
- 支持导入进度监控：实时显示导入进度、成功数量、失败数量
- 支持导入日志查看：详细的导入过程记录和错误信息

**DDL解析能力**：
- 自动解析表结构：表名、表描述、存储引擎、字符集、排序规则
- 自动解析字段信息：字段名、数据类型、长度、精度、是否为空、默认值
- 自动解析约束关系：主键、外键、唯一索引、普通索引、检查约束
- 自动解析分区信息：分区键、分区策略、分区数量
- 支持复杂DDL语法：视图、存储过程、函数、触发器等的解析

**用户界面设计**：
- 数据库连接配置页面：支持连接参数输入、连接测试、连接保存
- 表列表展示页面：支持分页表格、搜索筛选、勾选操作、批量操作
- 导入配置页面：支持导入模式选择、冲突处理策略、导入范围设置
- 导入进度页面：实时进度条、成功/失败统计、详细日志展示
- 导入结果页面：导入成功列表、失败原因分析、重试操作

**验收标准**：
- 支持至少5种主流数据库类型
- 数据库连接成功率 > 98%
- 表列表加载时间 < 5秒
- 导入成功率 > 95%
- 导入速度：单表 < 3秒，批量100表 < 5分钟
- 支持至少1000张表的批量导入

#### 2.1.2 在线建模模块 (P0)
**功能描述**：全屏独占式模型设计页面，提供自动保存、字段级评论与标准字段库快速引用的建模体验。

**详细需求**：
- 页面形态：独占式全屏页面（不使用弹窗），从列表进入或新建时直接进入模型设计页。
- 页面导航：提供"返回"按钮，支持返回模型管理列表页。
- 自动保存：任意编辑操作后自动保存（前端原型为可视指示；产品落地需服务端接口支持），展示"正在保存/已自动保存 时间"。
- 表级建模：
  - 表头设计：英文表名与中文名称可点击编辑，总体概述可点击编辑，分层与主题域为右侧下拉选择，自动保存时间显示在表头右侧。
  - 移除创建时间、更新时间显示（自动保存时间覆盖）。
- 字段级建模：
  - DWD/DIM：字段英文、字段中文、是否已配置、字段类型、长度/值、是否为空、默认值、是否主键、字段描述、来源系统、来源数据库、来源表、来源字段、来源字段类型。
  - DWS/ADS：在上面基础上新增"计算规则（表达式、聚合方式、口径说明）"。
- 列可见性控制：支持设置列表项的可见性，可将字段长度、是否为空、默认值等列默认隐藏，需要时可手动显示。
- 表格对齐：字段表格列头与数据列完全对齐，无错位。
- 来源信息联动：来源系统、来源数据库、来源表、来源字段、来源字段类型为独立列，支持级联选择，内容来自数据库连接配置。
- 评论功能：支持查看用户对字段的评论；允许查看者对字段右键添加评论（不要求多人协作编辑，仅评论）。
- 标准字段库：提供入口按钮，点击弹出标准字段库选择面板，支持将选中的标准字段快速插入当前模型字段列表。
- 字段快速导入：支持从已有数据库连接表信息或已有模型中快速导入字段到当前模型。
- 关系/索引/模板侧栏：本阶段不显示（移除原有侧栏与标签页）。

**验收标准**：
- 进入设计页为全屏独占式，无弹窗叠加；支持返回列表页。
- 表头信息精简，英文表名与中文名称点击编辑，总体概述点击编辑，分层与主题域下拉选择，自动保存时间显示在表头右侧。
- 字段表格列头与数据列完全对齐，无错位。
- 支持列可见性控制，可隐藏/显示指定列。
- 来源系统、来源数据库、来源表、来源字段、来源字段类型为独立列，支持级联选择。
- 字段右键可添加评论（原型交互可用）。
- 可从标准字段库面板快速插入字段到当前模型。
- 支持字段快速导入功能，可从数据库表或已有模型导入。
- 字段表头与数据项符合 DWD/DIM 与 DWS/ADS 的差异化要求。

#### 2.1.3 标准字段库 (P0)
**功能描述**：维护标准化的字段定义库，支持快速引用

**详细需求**：
- 字段分类管理：按业务域、数据类型、用途等分类
- 字段标准化：统一命名规范、类型定义、约束规则
- 快速搜索和引用
- 字段使用统计和推荐
- 支持自定义字段扩展

**验收标准**：
- 支持至少1000个标准字段
- 搜索响应时间 < 200ms
- 支持至少5个分类维度

#### 2.1.4 全局搜索模块 (P0)
**功能描述**：提供统一的搜索入口，支持多维度搜索

**详细需求**：
- 支持表、字段、文档、实体等全量搜索
- 支持模糊搜索和精确搜索
- 支持多条件组合筛选
- 搜索结果高亮和排序
- 搜索历史记录

**验收标准**：
- 搜索响应时间 < 300ms
- 支持至少10万条记录的搜索
- 搜索结果准确率 > 90%

#### 2.1.5 安全设置 (P0)
**功能描述**：提供用户账号的安全相关设置，当前版本仅支持内部账号登录与密码修改，注册与第三方账号绑定（如SSO、GitHub等）暂不开放。

**详细需求**：
- 密码修改：输入当前密码、新密码、确认新密码；新密码需满足最小长度与复杂度规则（至少6位，推荐数字/大小写字母/特殊字符组合）
- 表单校验：必填校验、新旧密码一致性校验、长度与复杂度校验
- 提交反馈：保存成功后提示；失败时展示错误信息与解决建议
- 安全提示：展示安全建议（如建议定期更换密码、不与他人共享）

**后续规划**：
- 第三方账号绑定：支持企业SSO、GitHub等快捷登录方式的绑定与解绑（后续版本开放）
- 安全日志与设备管理：近期登录记录、已登录设备的查看与下线

**验收标准**：
- 完成密码修改流程的前端交互与校验
- 成功与失败的反馈可感知
- 仅保留内部账号登录入口，注册与SSO入口不展示

#### 2.1.6 模型管理 (P0)
**功能描述**：集中管理数仓模型，支持按多种分类方式浏览与检索，提供完善的模型元数据与字段级信息维护，支持与数据源配置联动选择来源库表。

**详细需求**：

1) 模型分类（多种方式并存）
- 支持按主题域分类（例如：用户域、订单域、商品域等）
- 支持按数仓分层分类：ODS、DWD、DIM、DWS、ADS
- 支持在页面内切换分类维度（主题域/分层），并支持组合筛选（如：主题域=用户域 且 分层=DWD）
- 支持分类维度的多选筛选、搜索与统计计数

2) 模型基础信息（表级）
- 英文表名、中文名称、总体概述说明
- 主题域（多选）、分层（单选：ODS/DWD/DIM/DWS/ADS）
- 创建时间、更新时间、创建人、最近编辑人
- 状态：草稿/已发布/已归档，版本号

3) 模型详细信息（字段级）
- 针对 DWD/DIM 层字段，需包含：
  - 字段中文名、字段英文名
  - 是否已配置（标记字段是否在本平台内配置完成）
  - 字段类型、是否主键、字段描述
  - 来源业务系统、来源数据库、来源表、来源字段、来源字段类型（独立列）
- 针对 DWS/ADS 层字段，在以上基础上，需额外包含：
  - 计算规则/计算方法（表达式、聚合方式、口径说明）

4) 来源数据库/来源表联动
- 来源数据库/表/字段选项来自"数据源管理（数据库连接配置）"中已配置的连接
- 支持从指定连接自动拉取数据库/Schema/表/字段元数据下拉可选，支持搜索与级联
- 选中来源后，自动回填来源字段类型
- 来源系统、来源数据库、来源表、来源字段、来源字段类型为独立列，支持级联选择

5) 列表与检索
- 列表支持显示：英文表名、中文名称、分层、主题域、概述、类型（表/视图）、更新时间、统计信息（字段数/行数等）
- 支持关键词搜索（名称、概述、标签）、按分类维度筛选、按状态筛选、按更新时间排序
- 支持表格视图与卡片视图切换
- 支持列可见性控制，可隐藏/显示指定列（如字段长度、是否为空、默认值等）

6) 其他
- 支持查看/编辑/导出/删除，批量导出模型（含字段与来源映射）
- 与在线建模联动：从列表进入建模页进行字段级编辑
- 与DDL导入联动：从导入结果进入模型管理并补充来源映射
- 支持字段快速导入功能，可从数据库表或已有模型导入

**验收标准**：
- 支持主题域与分层两种分类维度，并可组合筛选
- 列表展示新增的分层、主题域、中文名称、概述等字段
- 字段级元数据满足 DWD/DIM 与 DWS/ADS 的差异化展示需求
- 来源数据库/表/字段可下拉选择自数据源配置，级联交互可用
- 来源系统、来源数据库、来源表、来源字段、来源字段类型为独立列，支持级联选择
- 支持列可见性控制，可隐藏/显示指定列
- 模型编辑页可查看与编辑基础信息与字段级信息，含计算规则配置（DWS/ADS）
- 支持字段快速导入功能，可从数据库表或已有模型导入

### 2.2 重要功能模块

#### 2.2.1 可视化血缘关系图 (P1)
**功能描述**：提供直观的模型血缘关系可视化展示

**详细需求**：
- 支持表级和字段级血缘关系展示
- 支持血缘图的缩放、拖拽、搜索
- 支持血缘深度控制（1-N层）
- 支持血缘路径高亮和追踪
- 支持血缘影响分析

**验收标准**：
- 支持至少1000个节点的血缘图
- 血缘图渲染时间 < 2秒
- 支持至少5层血缘深度

#### 2.2.2 模型文档与开发模型比对 (P1)
**功能描述**：自动比对设计文档与实际开发模型的一致性

**详细需求**：
- 支持字段级比对：名称、类型、约束、描述
- 支持表级比对：表结构、分区、存储格式
- 支持关系比对：主外键、索引关系
- 提供差异报告和修复建议
- 支持自定义比对规则

**验收标准**：
- 比对准确率 > 95%
- 支持至少1000个字段的批量比对
- 比对报告生成时间 < 30秒

### 2.3 高级功能模块

#### 2.3.1 飞书文档同步 (P2)
**功能描述**：自动同步飞书在线表格中的建模文档

**详细需求**：
- 支持飞书表格的自动解析
- 支持定时同步和手动同步
- 支持增量同步和冲突处理
- 提供同步状态监控
- 支持多文档源管理

**验收标准**：
- 同步成功率 > 90%
- 支持至少10个飞书文档源
- 同步延迟 < 5分钟

#### 2.3.2 数据治理模块 (P2)
**功能描述**：提供智能化的数据治理能力

**详细需求**：
- 字段语义识别和同义词检测
- 命名规范检查和自动修复建议
- 数据质量规则管理和执行
- 数据血缘影响分析
- 治理报告和仪表板

**验收标准**：
- 语义识别准确率 > 80%
- 支持至少1000个字段的批量治理
- 治理规则执行时间 < 10分钟

#### 2.3.3 协作功能 (P2)
**功能描述**：支持多人协作建模和文档管理

**详细需求**：
- 实时协作编辑
- 权限管理和角色控制
- 变更审批流程
- 协作历史记录
- 评论和讨论功能

**验收标准**：
- 支持至少50人同时协作
- 协作冲突解决时间 < 1分钟
- 权限变更生效时间 < 30秒

## 3. 非功能需求

### 3.1 性能需求
- 系统响应时间：页面加载 < 2秒，操作响应 < 500ms
- 并发用户数：支持至少100个并发用户
- 数据处理能力：支持至少100万条记录的处理

### 3.2 可用性需求
- 系统可用性：99.5%
- 数据备份：每日自动备份，支持7天回滚
- 故障恢复：RTO < 30分钟，RPO < 1小时

### 3.3 安全性需求
- 用户认证：当前仅支持内部账号登录，SSO和注册功能暂不开放
- 数据加密：传输和存储加密
- 权限控制：基于角色的访问控制(RBAC)
- 审计日志：完整的操作日志记录

### 3.4 兼容性需求
- 浏览器支持：Chrome 80+、Firefox 75+、Safari 13+
- 数据库支持：MySQL 8.0+、PostgreSQL 12+、Hive 3.0+
- 操作系统：支持Windows、macOS、Linux

## 4. 技术架构

### 4.1 整体架构
- **前端**：React/Vue + TypeScript + Ant Design
- **后端**：Spring Boot + Java/Kotlin 或 Node.js + TypeScript
- **数据库**：PostgreSQL + Redis + Elasticsearch
- **消息队列**：RabbitMQ/Kafka
- **容器化**：Docker + Kubernetes

### 4.2 核心组件
- **DDL解析引擎**：ANTLR + 自定义解析器
- **血缘计算引擎**：图算法 + 缓存优化
- **搜索引擎**：Elasticsearch + 自定义索引
- **协作引擎**：WebSocket + 操作转换算法
- **治理引擎**：规则引擎 + NLP服务

## 5. 开发计划

### 5.1 第一阶段 (MVP - 8周)
- DDL快速导入模块
- 在线建模基础功能
- 标准字段库
- 全局搜索功能

### 5.2 第二阶段 (核心功能 - 12周)
- 可视化血缘关系图
- 模型比对功能
- 基础协作功能
- 性能优化

### 5.3 第三阶段 (高级功能 - 16周)
- 飞书文档同步
- 数据治理模块
- 高级协作功能
- 系统集成和测试

## 6. 风险评估

### 6.1 技术风险
- **DDL解析复杂性**：不同数据库DDL语法差异较大
- **血缘计算性能**：大规模血缘图计算可能影响性能
- **协作冲突处理**：多人同时编辑的冲突解决算法复杂

### 6.2 业务风险
- **用户接受度**：从传统建模方式迁移的阻力
- **数据迁移**：现有建模数据的迁移和验证
- **培训成本**：用户培训和支持成本

### 6.3 缓解措施
- 采用成熟的解析器和算法
- 分阶段实施，先验证核心功能
- 提供详细的用户培训和文档

## 7. 成功指标

### 7.1 技术指标
- 系统性能达到设计要求
- 功能测试通过率 > 95%
- 代码覆盖率 > 80%

### 7.2 业务指标
- 用户采用率 > 70%
- 建模效率提升 > 50%
- 用户满意度 > 4.0/5.0

### 7.3 运营指标
- 系统可用性 > 99.5%
- 故障响应时间 < 30分钟
- 用户支持响应时间 < 4小时
