# 数据源管理模块 - 功能说明

## 模块概述

数据源管理模块是湖仓建模工具的核心功能之一，负责统一管理所有数据源连接配置，支持多种数据库类型，提供数据源列表和表结构查看功能。

## 功能特性

### 1. 数据源连接管理
- ✅ 支持MySQL、PostgreSQL、Hive、ClickHouse、Oracle、SQL Server、DB2、Snowflake等主流数据库
- ✅ 支持连接参数配置：主机、端口、数据库名、用户名、密码、连接池配置
- ✅ 提供连接测试功能，实时验证连接有效性
- ✅ 支持连接信息加密存储和连接历史管理
- ✅ 支持数据源分类管理（按数据库类型、业务域等）
- ✅ 支持数据源状态监控（连接状态、最后同步时间等）

### 2. 数据源列表管理
- ✅ 支持数据源列表展示，包含数据源名称、类型、状态、连接信息等
- ✅ 支持数据源搜索和筛选：按名称、类型、状态等条件筛选
- ✅ 支持数据源启用/禁用、编辑、删除等操作
- ✅ 支持数据源连接测试和同步状态查看

### 3. 数据表列表管理
- ✅ 展示所有数据源同步过来的数据库和数据表信息
- ✅ 支持按数据源、数据库、表名等维度筛选和搜索
- ✅ 支持查看表结构明细（字段名、类型、长度、是否为空、默认值、主键等）
- ✅ 不加载实际数据，仅展示元数据信息
- ✅ 支持表结构导出和同步状态查看
- ✅ 支持表结构变更监控和告警

## 技术实现

### 后端技术栈
- **框架**: Node.js + Express
- **数据库**: PostgreSQL
- **认证**: JWT + bcrypt
- **验证**: Joi
- **数据库驱动**: pg (node-postgres)

### 前端技术栈
- **框架**: React 18 + TypeScript
- **UI组件**: Ant Design 5
- **状态管理**: Zustand
- **HTTP客户端**: Axios
- **构建工具**: Vite

### 数据库设计

#### 数据源表 (data_sources)
```sql
CREATE TABLE data_sources (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  type VARCHAR(50) NOT NULL,
  connection_info JSONB NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  last_test_at TIMESTAMP,
  last_sync_at TIMESTAMP,
  created_by INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 数据表信息表 (tables)
```sql
CREATE TABLE tables (
  id SERIAL PRIMARY KEY,
  data_source_id INTEGER NOT NULL REFERENCES data_sources(id),
  table_name VARCHAR(100) NOT NULL,
  schema_name VARCHAR(100),
  description TEXT,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(data_source_id, table_name)
);
```

#### 字段信息表 (columns)
```sql
CREATE TABLE columns (
  id SERIAL PRIMARY KEY,
  table_id INTEGER NOT NULL REFERENCES tables(id),
  column_name VARCHAR(100) NOT NULL,
  data_type VARCHAR(50) NOT NULL,
  is_nullable BOOLEAN DEFAULT true,
  is_primary_key BOOLEAN DEFAULT false,
  default_value TEXT,
  description TEXT,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(table_id, column_name)
);
```

## API接口

### 数据源管理接口
- `GET /api/v1/data-sources` - 获取数据源列表
- `POST /api/v1/data-sources` - 创建数据源
- `GET /api/v1/data-sources/:id` - 获取数据源详情
- `PUT /api/v1/data-sources/:id` - 更新数据源
- `DELETE /api/v1/data-sources/:id` - 删除数据源
- `POST /api/v1/data-sources/:id/test` - 测试数据源连接

### 数据表管理接口
- `GET /api/v1/data-sources/:id/tables` - 获取数据源下的表列表
- `GET /api/v1/tables/:id/columns` - 获取表字段信息
- `POST /api/v1/data-sources/:id/sync` - 同步数据源表结构

## 使用说明

### 1. 添加数据源
1. 点击"添加数据源"按钮
2. 选择数据库类型
3. 填写连接参数
4. 测试连接
5. 保存配置

### 2. 管理数据源
1. 在数据源列表中查看所有数据源
2. 点击"编辑"修改配置
3. 点击"测试"验证连接
4. 点击"同步"更新表结构

### 3. 查看表结构
1. 选择数据源
2. 查看数据库和表列表
3. 点击表名查看字段详情
4. 导出表结构信息

## 注意事项

1. **连接安全**: 所有连接信息都会加密存储
2. **权限控制**: 只有授权用户才能管理数据源
3. **性能考虑**: 表结构同步采用增量更新策略
4. **错误处理**: 连接失败时会提供详细的错误信息

## 更新日志

- **v1.0.0** - 初始版本，支持基础的数据源管理功能
- **v1.1.0** - 增加连接池配置和性能优化
- **v1.2.0** - 增加数据源分类和状态监控功能
