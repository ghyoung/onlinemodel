# æ ¡éªŒè„šæœ¬ä½¿ç”¨è¯´æ˜

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2024-08-15  
**ä½œè€…**: å¼€å‘å›¢é˜Ÿ  

## ç›®å½•
- [æ¦‚è¿°](#æ¦‚è¿°)
- [è„šæœ¬ä½ç½®](#è„šæœ¬ä½ç½®)
- [è„šæœ¬åŠŸèƒ½è¯´æ˜](#è„šæœ¬åŠŸèƒ½è¯´æ˜)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [è¾“å‡ºç¤ºä¾‹](#è¾“å‡ºç¤ºä¾‹)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

## æ¦‚è¿°

æœ¬é¡¹ç›®çš„æ ¡éªŒè„šæœ¬ç”¨äºç¡®ä¿ç³»ç»Ÿçš„ä¸€è‡´æ€§ï¼ŒåŒ…æ‹¬æ•°æ®åº“ç»“æ„ã€å‰åç«¯æ¥å£ã€æ–‡ä»¶å®Œæ•´æ€§ç­‰ã€‚è¿™äº›è„šæœ¬æ˜¯å¼€å‘è´¨é‡ä¿è¯çš„é‡è¦å·¥å…·ã€‚

## è„šæœ¬ä½ç½®

æ‰€æœ‰æ ¡éªŒè„šæœ¬éƒ½ä½äº `code/init-scripts/` ç›®å½•ä¸‹ï¼š

```
code/init-scripts/
â”œâ”€â”€ fix-database.js          # æ•°æ®åº“ä¿®å¤è„šæœ¬
â”œâ”€â”€ quick-validate.js        # å¿«é€Ÿæ ¡éªŒè„šæœ¬
â”œâ”€â”€ validate-system.js       # å®Œæ•´ç³»ç»Ÿæ ¡éªŒè„šæœ¬
â”œâ”€â”€ package.json             # ä¾èµ–é…ç½®
â””â”€â”€ å…¶ä»–è„šæœ¬æ–‡ä»¶...
```

## è„šæœ¬åŠŸèƒ½è¯´æ˜

### 1. fix-database.js
**åŠŸèƒ½**: ä¿®å¤æ•°æ®åº“è¡¨ç»“æ„ä¸ä¸€è‡´é—®é¢˜
- æ£€æŸ¥ç¼ºå¤±çš„å­—æ®µ
- è‡ªåŠ¨æ·»åŠ å¿…éœ€çš„å­—æ®µ
- éªŒè¯ä¿®å¤ç»“æœ

**é€‚ç”¨åœºæ™¯**: 
- æ•°æ®åº“ç»“æ„é”™è¯¯
- å­—æ®µç¼ºå¤±é—®é¢˜
- è¡¨ç»“æ„ä¸å®Œæ•´

### 2. quick-validate.js
**åŠŸèƒ½**: å¿«é€Ÿç³»ç»Ÿæ ¡éªŒ
- æ•°æ®åº“è¿æ¥æ£€æŸ¥
- æ ¸å¿ƒè¡¨è®¿é—®éªŒè¯
- å…³é”®å­—æ®µå­˜åœ¨æ€§æ£€æŸ¥

**é€‚ç”¨åœºæ™¯**:
- æ—¥å¸¸å¼€å‘æ£€æŸ¥
- å¿«é€Ÿé—®é¢˜æ’æŸ¥
- å¯åŠ¨å‰éªŒè¯

### 3. validate-system.js
**åŠŸèƒ½**: å®Œæ•´ç³»ç»Ÿæ ¡éªŒ
- æ•°æ®åº“è¡¨ç»“æ„è¯¦ç»†æ£€æŸ¥
- åç«¯APIæ–‡ä»¶å®Œæ•´æ€§
- å‰ç«¯ç»„ä»¶å®Œæ•´æ€§
- ç¯å¢ƒé…ç½®æ£€æŸ¥
- ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

**é€‚ç”¨åœºæ™¯**:
- åŠŸèƒ½å¼€å‘å®Œæˆå
- éƒ¨ç½²å‰æ£€æŸ¥
- é—®é¢˜æ·±åº¦æ’æŸ¥

## ä½¿ç”¨æ–¹æ³•

### å‰ç½®æ¡ä»¶
ç¡®ä¿å·²å®‰è£…å¿…è¦çš„ä¾èµ–ï¼š
```bash
cd code/init-scripts
npm install
```

### ç›´æ¥è¿è¡Œè„šæœ¬
```bash
# æ•°æ®åº“ä¿®å¤
node fix-database.js

# å¿«é€Ÿæ ¡éªŒ
node quick-validate.js

# å®Œæ•´æ ¡éªŒ
node validate-system.js
```

### é€šè¿‡å¯åŠ¨è„šæœ¬è¿è¡Œ
```bash
# å¿«é€Ÿæ ¡éªŒ
./start-dev.sh quick-validate

# å®Œæ•´æ ¡éªŒ
./start-dev.sh validate

# è‡ªåŠ¨æ ¡éªŒï¼ˆå¯åŠ¨æ—¶ï¼‰
./start-dev.sh
```

## è¾“å‡ºç¤ºä¾‹

### fix-database.js è¾“å‡ºç¤ºä¾‹
```
ğŸ”§ å¼€å§‹ä¿®å¤æ•°æ®åº“ç»“æ„...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ“‹ å½“å‰data_sourcesè¡¨åˆ—: [id, name, type, connection_info, status, created_by, created_at, updated_at]
ğŸ”§ å‘ç°ç¼ºå°‘descriptionå­—æ®µï¼Œæ­£åœ¨æ·»åŠ ...
âœ… descriptionå­—æ®µæ·»åŠ æˆåŠŸ
ğŸ”§ å‘ç°ç¼ºå°‘last_test_atå­—æ®µï¼Œæ­£åœ¨æ·»åŠ ...
âœ… last_test_atå­—æ®µæ·»åŠ æˆåŠŸ
ğŸ”§ å‘ç°ç¼ºå°‘last_sync_atå­—æ®µï¼Œæ­£åœ¨æ·»åŠ ...
âœ… last_sync_atå­—æ®µæ·»åŠ æˆåŠŸ
ğŸ“‹ ä¿®å¤åçš„data_sourcesè¡¨åˆ—: [id, name, type, connection_info, status, created_by, created_at, updated_at, description, last_test_at, last_sync_at]
âœ… æ•°æ®åº“ä¿®å¤å®Œæˆ
```

### quick-validate.js è¾“å‡ºç¤ºä¾‹
```
ğŸ” å¿«é€Ÿç³»ç»Ÿæ ¡éªŒ...
âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
âœ… è¡¨ data_sources å¯è®¿é—®
âœ… è¡¨ models å¯è®¿é—®
âœ… è¡¨ users å¯è®¿é—®
âœ… data_sources.description å­—æ®µå­˜åœ¨
âœ… å¿«é€Ÿæ ¡éªŒå®Œæˆ
```

### validate-system.js è¾“å‡ºç¤ºä¾‹
```
ğŸš€ å¼€å§‹ç³»ç»Ÿä¸€è‡´æ€§æ ¡éªŒ...
ğŸ” å¼€å§‹éªŒè¯ç¯å¢ƒé…ç½®...
âœ… ç¯å¢ƒé…ç½®æ–‡ä»¶å­˜åœ¨: ../backend/env.config.js
âœ… ç¯å¢ƒé…ç½®æ–‡ä»¶å­˜åœ¨: ../frontend/env.config.js
âœ… package.jsonå­˜åœ¨: ../backend/package.json
âœ… package.jsonå­˜åœ¨: ../frontend/package.json
âœ… ç¯å¢ƒé…ç½®éªŒè¯å®Œæˆ
ğŸ” å¼€å§‹éªŒè¯æ•°æ®åº“ç»“æ„...
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ
ğŸ“‹ è¡¨ data_sources å½“å‰åˆ—: id, name, type, connection_info, status, created_by, created_at, updated_at, description, last_test_at, last_sync_at
âœ… æ•°æ®åº“ç»“æ„éªŒè¯å®Œæˆ
ğŸ” å¼€å§‹éªŒè¯åç«¯API...
âœ… è·¯ç”±æ–‡ä»¶å­˜åœ¨: src/routes/auth.js
âœ… è·¯ç”±æ–‡ä»¶å­˜åœ¨: src/routes/dataSource.js
âœ… åç«¯APIéªŒè¯å®Œæˆ
ğŸ” å¼€å§‹éªŒè¯å‰ç«¯ç»“æ„...
âœ… é¡µé¢ç»„ä»¶å­˜åœ¨: src/pages/Dashboard.tsx
âœ… é¡µé¢ç»„ä»¶å­˜åœ¨: src/pages/DataSourceManagement.tsx
âœ… å‰ç«¯ç»“æ„éªŒè¯å®Œæˆ

ğŸ“Š ç³»ç»Ÿä¸€è‡´æ€§æ ¡éªŒæŠ¥å‘Š
==================================================
âœ… æˆåŠŸé¡¹ç›®: 15
âš ï¸  è­¦å‘Šé¡¹ç›®: 0
âŒ é”™è¯¯é¡¹ç›®: 0
ğŸ‰ ç³»ç»Ÿä¸€è‡´æ€§æ ¡éªŒé€šè¿‡ï¼
ğŸ“„ è¯¦ç»†æŠ¥å‘Šå·²ä¿å­˜åˆ°: /path/to/validation-report.json
```

## æ•…éšœæ’é™¤

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. ä¾èµ–åŒ…ç¼ºå¤±é”™è¯¯
```
Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'pg'
```
**è§£å†³æ–¹æ¡ˆ**:
```bash
cd code/init-scripts
npm install pg
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```
error: connect ECONNREFUSED 127.0.0.1:5432
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥PostgreSQLæœåŠ¡æ˜¯å¦å¯åŠ¨
- éªŒè¯æ•°æ®åº“è¿æ¥é…ç½®
- ç¡®è®¤ç«¯å£å·æ˜¯å¦æ­£ç¡®

#### 3. æƒé™é”™è¯¯
```
error: permission denied for table data_sources
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·æƒé™
- ç¡®è®¤ç”¨æˆ·æœ‰è¡¨çš„è¯»å†™æƒé™

#### 4. è¡¨ä¸å­˜åœ¨é”™è¯¯
```
error: relation "data_sources" does not exist
```
**è§£å†³æ–¹æ¡ˆ**:
- è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- æ£€æŸ¥è¡¨åæ‹¼å†™æ˜¯å¦æ­£ç¡®

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**:
```bash
DEBUG=* node validate-system.js
```

2. **æ£€æŸ¥é…ç½®æ–‡ä»¶**:
```bash
node -e "console.log(require('../backend/env.config.js'))"
```

3. **éªŒè¯æ•°æ®åº“è¿æ¥**:
```bash
cd code/backend
node test-db-connection.js
```

## ç›¸å…³æ–‡æ¡£

- [å¼€å‘è§„èŒƒä¸æ ¡éªŒè§„åˆ™](./å¼€å‘è§„èŒƒä¸æ ¡éªŒè§„åˆ™.md)
- [æŠ€æœ¯å¯è¡Œæ€§åˆ†æ](./æŠ€æœ¯å¯è¡Œæ€§åˆ†æ.md)
- [æ¹–ä»“å»ºæ¨¡å·¥å…·å¼€å‘è®¡åˆ’](./æ¹–ä»“å»ºæ¨¡å·¥å…·å¼€å‘è®¡åˆ’.md)
- [ç«¯å£é…ç½®è¯´æ˜](./ç«¯å£é…ç½®è¯´æ˜.md)

---

**æ³¨æ„**: è¿è¡Œæ ¡éªŒè„šæœ¬å‰ï¼Œè¯·ç¡®ä¿æ•°æ®åº“æœåŠ¡æ­£å¸¸è¿è¡Œï¼Œå¹¶ä¸”æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œç›¸å…³æ“ä½œã€‚
