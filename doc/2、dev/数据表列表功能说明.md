# 数据表列表功能说明

## 功能概述

数据表列表功能是数据源管理模块的重要组成部分，允许用户查看和管理数据源下的所有数据表。该功能提供了完整的表结构浏览、字段查看、搜索筛选和同步更新等能力。

## 主要特性

### 1. 数据表列表展示
- 显示数据源下的所有数据表
- 支持分页浏览
- 显示表的基本信息：表名、模式名、描述、字段数、主键数等
- 支持按状态筛选（活跃/未激活）

### 2. 搜索和筛选
- 支持按表名、模式名、描述进行模糊搜索
- 支持按状态筛选
- 实时搜索功能

### 3. 表结构同步
- 一键同步数据源的表结构
- 自动更新表信息
- 显示同步结果统计

### 4. 字段详情查看
- 查看表的完整字段信息
- 显示字段类型、约束、描述等
- 支持主键标识

### 5. 统计信息
- 总表数统计
- 活跃表数量
- 总字段数统计
- 总主键数统计

## 技术实现

### 后端API接口

#### 1. 获取数据表列表
```
GET /api/data-sources/:id/tables
```

**查询参数：**
- `page`: 页码（默认1）
- `limit`: 每页数量（默认10）
- `search`: 搜索关键词
- `status`: 状态筛选

**响应示例：**
```json
{
  "success": true,
  "data": {
    "dataSource": {
      "id": 1,
      "name": "MySQL主库"
    },
    "tables": [
      {
        "id": 1,
        "tableName": "users",
        "schemaName": "public",
        "description": "用户信息表",
        "status": "active",
        "columnCount": 5,
        "primaryKeyCount": 1,
        "createdAt": "2024-01-01T00:00:00Z",
        "updatedAt": "2024-01-01T00:00:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 25,
      "pages": 3
    }
  }
}
```

#### 2. 获取表字段信息
```
GET /api/data-sources/:dataSourceId/tables/:tableId/columns
```

**响应示例：**
```json
{
  "success": true,
  "data": {
    "table": {
      "id": 1,
      "tableName": "users",
      "schemaName": "public",
      "description": "用户信息表"
    },
    "columns": [
      {
        "id": 1,
        "columnName": "id",
        "dataType": "INTEGER",
        "isNullable": false,
        "isPrimaryKey": true,
        "defaultValue": "",
        "description": "主键ID",
        "status": "active"
      }
    ]
  }
}
```

#### 3. 同步表结构
```
POST /api/data-sources/:id/sync-tables
```

**响应示例：**
```json
{
  "success": true,
  "message": "表结构同步完成",
  "data": {
    "totalTables": 25,
    "newTables": 3,
    "updatedTables": 2,
    "errors": []
  }
}
```

### 前端组件

#### DataSourceTables组件
- 位置：`src/components/DataSourceTables.tsx`
- 功能：数据表列表的核心组件
- 特性：
  - 响应式设计
  - 支持搜索和筛选
  - 分页显示
  - 字段详情模态框

#### 集成方式
在数据源管理页面中，通过"查看表"按钮打开数据表列表模态框：

```tsx
<Button
  type="text"
  icon={<TableOutlined />}
  size="small"
  onClick={() => setViewingTables(record)}
>
  查看表
</Button>
```

## 数据库结构

### tables表
```sql
CREATE TABLE tables (
  id SERIAL PRIMARY KEY,
  data_source_id INTEGER NOT NULL REFERENCES data_sources(id),
  table_name VARCHAR(100) NOT NULL,
  schema_name VARCHAR(100),
  description TEXT,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(data_source_id, table_name)
);
```

### columns表
```sql
CREATE TABLE columns (
  id SERIAL PRIMARY KEY,
  table_id INTEGER NOT NULL REFERENCES tables(id),
  column_name VARCHAR(100) NOT NULL,
  data_type VARCHAR(50) NOT NULL,
  is_nullable BOOLEAN DEFAULT true,
  is_primary_key BOOLEAN DEFAULT false,
  default_value TEXT,
  description TEXT,
  ordinal_position INTEGER DEFAULT 0,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  UNIQUE(table_id, column_name)
);
```

## 使用说明

### 1. 查看数据表
1. 在数据源管理页面，找到要查看的数据源
2. 点击操作列中的"查看表"按钮
3. 系统将打开数据表列表模态框
4. 可以浏览该数据源下的所有数据表

### 2. 搜索和筛选
1. 在搜索框中输入关键词（表名、模式名或描述）
2. 选择状态筛选条件
3. 点击搜索按钮或按回车键
4. 系统将显示匹配的结果

### 3. 查看字段详情
1. 在数据表列表中，点击"查看字段"按钮
2. 系统将显示该表的字段详情模态框
3. 可以查看所有字段的类型、约束、描述等信息

### 4. 同步表结构
1. 在数据表列表页面，点击"同步表结构"按钮
2. 系统将连接到数据源并同步最新的表结构
3. 同步完成后会显示结果统计

## 注意事项

1. **权限控制**：只有具有相应权限的用户才能查看和操作数据表
2. **数据同步**：表结构同步功能需要数据源连接正常
3. **性能考虑**：大量表的加载可能需要较长时间，建议使用分页
4. **错误处理**：网络异常或权限不足时会显示相应的错误提示

## 扩展功能

### 未来计划
1. **表结构对比**：支持不同版本表结构的对比
2. **字段映射**：支持字段间的映射关系管理
3. **数据预览**：支持表数据的预览和导出
4. **血缘分析**：支持表间的血缘关系分析
5. **质量评估**：支持表结构质量评估和优化建议

## 故障排除

### 常见问题

1. **无法加载数据表**
   - 检查数据源连接状态
   - 确认用户权限
   - 检查网络连接

2. **同步失败**
   - 检查数据源配置
   - 确认网络连通性
   - 查看后端日志

3. **字段信息不完整**
   - 检查数据库权限
   - 确认表结构完整性
   - 重新同步表结构

### 日志查看
- 前端：浏览器开发者工具控制台
- 后端：服务器日志文件
- 数据库：PostgreSQL日志

## 总结

数据表列表功能为数据源管理提供了完整的表结构管理能力，支持用户高效地浏览、搜索和管理数据表。通过合理的架构设计和用户界面，该功能能够满足大多数数据管理场景的需求，为后续的数据建模和分析工作奠定基础。
