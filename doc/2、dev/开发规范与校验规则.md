# 湖仓建模工具开发规范与校验规则

**版本**: v1.0.0  
**更新日期**: 2024-08-15  
**作者**: 开发团队  

## 目录
- [核心原则](#核心原则)
- [开发流程规则](#开发流程规则)
- [校验脚本使用指南](#校验脚本使用指南)
- [常见问题及解决方案](#常见问题及解决方案)
- [校验报告解读](#校验报告解读)
- [自动化建议](#自动化建议)
- [最佳实践](#最佳实践)
- [质量目标](#质量目标)

## 🎯 核心原则

**系统一致性是开发质量的基础** - 前后端、接口、数据库必须保持同步，避免运行时错误。

## 📋 开发流程规则

### 1. 功能开发前
- [ ] 确认数据库表结构设计
- [ ] 确认API接口规范
- [ ] 确认前端组件需求

### 2. 功能开发中
- [ ] 数据库变更后立即更新相关代码
- [ ] API接口变更后同步更新前端调用
- [ ] 前端组件变更后确认后端支持

### 3. 功能开发后
- [ ] 运行 `quick-validate.js` 进行快速检查
- [ ] 运行 `validate-system.js` 进行完整校验
- [ ] 修复所有不一致问题

## 🛠️ 校验脚本使用指南

### 快速校验 (日常使用)
```bash
cd code/init-scripts
node quick-validate.js
```
**用途**: 开发过程中的快速检查，验证基本连接和关键字段

### 完整校验 (重要节点)
```bash
cd code/init-scripts
node validate-system.js
```
**用途**: 
- 功能开发完成后
- 部署前检查
- 问题排查时

### 数据库修复
```bash
cd code/init-scripts
node fix-database.js
```
**用途**: 数据库结构不一致时的修复

### 启动脚本集成
```bash
# 快速校验
./start-dev.sh quick-validate

# 完整校验
./start-dev.sh validate

# 自动校验（启动时）
./start-dev.sh
```

## 🚨 常见问题及解决方案

### 问题1: 字段不存在错误
```
error: 'column "description" of relation "data_sources" does not exist'
```
**解决方案**: 运行 `fix-database.js`

### 问题2: 表不存在错误
```
error: 'relation "data_sources" does not exist'
```
**解决方案**: 检查数据库初始化脚本，确认表已创建

### 问题3: API接口404
**解决方案**: 检查路由配置，确认前后端接口路径一致

### 问题4: 依赖包缺失
```
Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'pg'
```
**解决方案**: 在 `code/init-scripts` 目录运行 `npm install pg`

## 📊 校验报告解读

### 成功项目 (✅)
- 系统组件正常
- 无需处理

### 警告项目 (⚠️)
- 潜在问题，建议修复
- 不影响基本功能

### 错误项目 (❌)
- 必须修复的问题
- 会导致运行时错误

## 🔄 自动化建议

### 1. Git Hooks
在 `pre-commit` 钩子中添加快速校验：
```bash
#!/bin/sh
cd code/init-scripts && node quick-validate.js
```

### 2. CI/CD 集成
在部署流程中添加完整校验：
```yaml
- name: 系统一致性校验
  run: |
    cd code/init-scripts
    node validate-system.js
```

### 3. 开发环境启动检查
在 `start-dev.sh` 中添加校验：
```bash
echo "🔍 检查系统一致性..."
cd code/init-scripts
node quick-validate.js
```

## 📝 最佳实践

1. **每日开发开始前** 运行快速校验
2. **功能开发完成后** 运行完整校验
3. **部署前** 必须通过完整校验
4. **遇到运行时错误时** 先运行校验脚本排查
5. **数据库结构变更后** 立即更新相关代码和校验规则

## 🎯 质量目标

- ✅ 零运行时结构错误
- ✅ 前后端接口100%一致
- ✅ 数据库表结构完整
- ✅ 系统组件完整性100%

## 📚 相关文档

- [技术可行性分析](./技术可行性分析.md)
- [湖仓建模工具开发计划](./湖仓建模工具开发计划.md)
- [端口配置说明](./端口配置说明.md)
- [项目说明文档](./项目说明文档.md)

---

**记住**: 预防胜于治疗，定期校验比问题修复更高效！
