# 数据源管理模块需求文档

## 1. 项目概述

### 1.1 项目背景
数据源管理模块是湖仓建模平台的核心组件，用于统一管理和配置各种类型的数据源，为后续的数据建模、分析和血缘关系追踪提供数据基础。

### 1.2 项目目标
- 提供统一的数据源管理界面
- 支持多种数据库类型的连接配置
- 实现数据源的健康监控和状态管理
- 为数据建模提供可靠的数据源支持

### 1.3 项目范围
- 数据源的增删改查操作
- 数据源连接测试和状态监控
- 数据源权限管理和安全控制
- 数据源统计信息和报表展示

---

## 2. 功能需求

### 2.1 数据源列表管理

#### 2.1.1 功能描述
用户可以在数据源管理页面查看所有已配置的数据源，支持分页显示和条件筛选。

#### 2.1.2 功能要求
- [x] 分页显示数据源列表
- [x] 支持按类型筛选（MySQL、PostgreSQL等）
- [x] 支持按状态筛选（活跃、禁用、错误等）
- [x] 显示数据源基本信息（名称、类型、状态、创建时间等）
- [x] 支持排序（按创建时间、名称等）

#### 2.1.3 界面要求
- 响应式设计，支持不同屏幕尺寸
- 清晰的数据展示，重要信息突出显示
- 操作按钮布局合理，易于使用

### 2.2 数据源创建

#### 2.2.1 功能描述
用户可以创建新的数据源，配置连接参数和基本信息。

#### 2.2.2 功能要求
- [x] 支持多种数据库类型
- [x] 必填字段验证（名称、类型、主机、端口、数据库名、用户名、密码）
- [x] 可选字段（描述、连接参数）
- [x] 名称唯一性检查
- [x] 连接参数格式验证

#### 2.2.3 支持的数据库类型
- [x] MySQL
- [x] PostgreSQL
- [x] SQL Server
- [x] Oracle
- [x] MongoDB
- [x] Redis
- [x] 其他自定义类型

### 2.3 数据源编辑

#### 2.3.1 功能描述
用户可以修改已存在数据源的配置信息。

#### 2.3.2 功能要求
- [x] 支持修改所有可配置字段
- [x] 密码字段可选更新（为空时保留原密码）
- [x] 名称唯一性检查
- [x] 修改历史记录

### 2.4 数据源删除

#### 2.4.1 功能描述
用户可以删除不需要的数据源。

#### 2.4.2 功能要求
- [x] 软删除（标记为deleted状态）
- [x] 删除前检查关联关系
- [x] 删除确认提示
- [x] 支持批量删除（未来版本）

### 2.5 数据源连接测试

#### 2.5.1 功能描述
用户可以测试数据源连接是否正常。

#### 2.5.2 功能要求
- [x] 实时连接测试
- [x] 连接结果反馈
- [x] 测试时间记录
- [x] 错误信息详细展示

### 2.6 数据源状态管理

#### 2.6.1 功能描述
用户可以启用或禁用数据源。

#### 2.6.2 功能要求
- [x] 状态切换（active/inactive）
- [x] 状态变更记录
- [x] 状态变更通知
- [x] 批量状态管理（未来版本）

### 2.7 数据源统计信息

#### 2.7.1 功能描述
展示数据源的整体统计信息。

#### 2.7.2 功能要求
- [x] 总数据源数量
- [x] 活跃数据源数量
- [x] 错误状态数据源数量
- [x] 已启用数据源数量
- [x] 实时更新统计信息

---

## 3. 非功能需求

### 3.1 性能要求
- 数据源列表加载时间 < 2秒
- 连接测试响应时间 < 5秒
- 支持1000+数据源的管理
- 并发用户数 > 100

### 3.2 安全要求
- [x] JWT Token认证
- [x] 用户权限控制
- [x] 密码加密存储
- [x] 操作日志记录
- [x] 敏感信息保护

### 3.3 可用性要求
- 系统可用性 > 99.5%
- 友好的错误提示
- 操作确认机制
- 数据备份和恢复

### 3.4 兼容性要求
- 支持主流浏览器（Chrome、Firefox、Safari、Edge）
- 支持移动端访问
- 支持不同分辨率屏幕

---

## 4. 用户角色和权限

### 4.1 管理员（admin）
- 所有数据源的增删改查权限
- 系统配置管理权限
- 用户管理权限

### 4.2 普通用户（user）
- 查看数据源列表
- 创建个人数据源
- 编辑自己创建的数据源
- 删除自己创建的数据源

### 4.3 只读用户（viewer）
- 查看数据源列表
- 查看数据源详情
- 无修改权限

---

## 5. 数据模型

### 5.1 数据源表（data_sources）
```sql
CREATE TABLE data_sources (
  id SERIAL PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  type VARCHAR(50) NOT NULL,
  connection_info JSONB NOT NULL,
  status VARCHAR(20) DEFAULT 'active',
  last_test_at TIMESTAMP,
  last_sync_at TIMESTAMP,
  created_by INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 5.2 连接信息结构
```json
{
  "host": "localhost",
  "port": 3306,
  "database": "test_db",
  "username": "user",
  "password": "encrypted_password",
  "connectionParams": "charset=utf8mb4"
}
```

---

## 6. 接口规范

### 6.1 认证方式
- 使用JWT Token进行身份认证
- Token在请求Header中传递：`Authorization: Bearer <token>`

### 6.2 响应格式
- 统一使用JSON格式
- 包含success、data、message等标准字段
- 错误响应包含详细的错误信息

### 6.3 状态码规范
- 200: 请求成功
- 201: 创建成功
- 400: 请求参数错误
- 401: 未认证
- 403: 权限不足
- 404: 资源不存在
- 500: 服务器内部错误

---

## 7. 测试要求

### 7.1 功能测试
- [x] 数据源CRUD操作测试
- [x] 连接测试功能验证
- [x] 权限控制测试
- [x] 错误处理测试

### 7.2 性能测试
- 大数据量下的性能表现
- 并发访问测试
- 连接池性能测试

### 7.3 安全测试
- 认证机制测试
- 权限控制测试
- SQL注入防护测试
- XSS防护测试

---

## 8. 部署要求

### 8.1 环境要求
- Node.js >= 16.0.0
- PostgreSQL >= 12.0
- 内存 >= 4GB
- 存储 >= 20GB

### 8.2 配置要求
- 数据库连接配置
- JWT密钥配置
- 日志配置
- 监控配置

---

## 9. 维护和支持

### 9.1 监控要求
- 系统性能监控
- 错误日志监控
- 用户行为分析
- 数据源连接状态监控

### 9.2 备份要求
- 数据库定期备份
- 配置文件备份
- 日志文件归档

---

## 10. 项目里程碑

### 10.1 第一阶段（已完成）
- [x] 基础架构搭建
- [x] 数据库设计
- [x] 基础CRUD功能
- [x] 用户认证系统

### 10.2 第二阶段（进行中）
- [x] 前端界面开发
- [x] API接口完善
- [x] 错误处理优化
- [x] 性能优化

### 10.3 第三阶段（计划中）
- [ ] 高级功能开发
- [ ] 性能监控
- [ ] 自动化测试
- [ ] 文档完善

---

## 11. 风险评估

### 11.1 技术风险
- 数据库连接稳定性
- 大数据量处理性能
- 安全性漏洞

### 11.2 项目风险
- 需求变更频繁
- 开发进度延迟
- 测试覆盖不足

### 11.3 风险缓解措施
- 技术预研和验证
- 敏捷开发方法
- 自动化测试覆盖
- 定期代码审查

---

*文档版本: v1.0.0*  
*最后更新: 2025-08-14*  
*文档维护: 开发团队*
